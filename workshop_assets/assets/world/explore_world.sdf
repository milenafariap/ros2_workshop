<?xml version="1.0" ?>
<sdf version="1.9">
  <!-- ===================================================================== -->
  <!--  WORLD: cena, física, plugins essenciais                               -->
  <!-- ===================================================================== -->
  <world name="explore_world">
    <scene>
      <ambient>0.4 0.4 0.4 1</ambient>
      <background>0.6 0.8 0.6 1</background>
      <shadows>true</shadows>
    </scene>
    <gravity>0 0 -9.8</gravity>

    <!-- Plugins de mundo (DEVEM ser filhos diretos de <world>) -->
    <plugin filename="libignition-gazebo-physics-system.so"
            name="ignition::gazebo::systems::Physics"/>
    <plugin filename="libignition-gazebo-user-commands-system.so"
            name="ignition::gazebo::systems::UserCommands"/>
    <plugin filename="libignition-gazebo-scene-broadcaster-system.so"
            name="ignition::gazebo::systems::SceneBroadcaster"/>
    <plugin filename="libignition-gazebo-sensors-system.so" name="ignition::gazebo::systems::Sensors">
        <render_engine>ogre2</render_engine>
    </plugin>

    <!-- =================================================================== -->
    <!--  CHÃO E ILUMINAÇÃO                                                  -->
    <!-- =================================================================== -->
    <model name="ground_plane">
      <static>true</static>
      <link name="link">
        <collision name="collision">
          <geometry>
            <plane><normal>0 0 1</normal><size>50 50</size></plane>
          </geometry>
        </collision>
        <visual name="visual">
          <geometry>
            <plane><normal>0 0 1</normal><size>50 50</size></plane>
          </geometry>
          <material>
            <ambient>0.1 0.4 0.1 1</ambient>
            <diffuse>0.1 0.6 0.1 1</diffuse>
            <specular>0 0 0 1</specular>
          </material>
        </visual>
      </link>
    </model>

    <!-- Obstáculo com COLLISION (o LiDAR enxerga colisão, não o visual) -->
    <model name="box_obstacle">
      <static>true</static>
      <pose>2 0 0.5 0 0 0</pose> <!-- centro z=0.5; altura=1.0 -->
      <link name="link">
        <collision name="col">
          <geometry><box><size>0.5 0.5 1.0</size></box></geometry>
        </collision>
        <visual name="vis">
          <geometry><box><size>0.5 0.5 1.0</size></box></geometry>
          <material><diffuse>1 0 0 1</diffuse></material>
        </visual>
      </link>
    </model>

    <!-- Luz direcional simples -->
    <light name="sun" type="directional">
      <pose>0 0 10 0 0 0</pose>
      <direction>-0.5 0.1 -1</direction>
      <diffuse>0.8 0.8 0.8 1</diffuse>
      <specular>0.2 0.2 0.2 1</specular>
      <cast_shadows>true</cast_shadows>
    </light>

    <!-- =================================================================== -->
    <!--  ROBÔ DIFFERENTIAL: chassi, rodas, sensores e plugin DiffDrive      -->
    <!-- =================================================================== -->
    <model name="vehicle_blue" canonical_link="base_link">
      <!-- Pose do robô no mundo -->
      <pose>-3 0 0 0 0 0</pose>

      <!-- ----------------------------- -->
      <!-- CHASSI (base_link)            -->
      <!-- ----------------------------- -->
      <link name="base_link">
        <!-- altura do centro = 0.20; caixa 0.10 de altura => folga 0.15 do chão -->
        <pose>0.5 0 0.20 0 0 0</pose>
        <inertial>
          <mass>1.14</mass>
          <inertia>
            <ixx>0.095329</ixx><iyy>0.381317</iyy><izz>0.476646</izz>
            <ixy>0</ixy><ixz>0</ixz><iyz>0</iyz>
          </inertia>
        </inertial>
        <collision name="collision">
          <geometry><box><size>0.5 0.2 0.1</size></box></geometry>
        </collision>
        <visual name="visual">
          <geometry><box><size>0.5 0.2 0.1</size></box></geometry>
          <material>
            <ambient>0 0 1 1</ambient>
            <diffuse>0 0 1 1</diffuse>
            <specular>0 0 1 1</specular>
          </material>
        </visual>
        <!-- IMU no chassi -->
        <sensor name="imu_sensor" type="imu">
          <pose>0 0 0 0 0 0</pose>
          <topic>/imu/data</topic>
          <always_on>true</always_on>
          <update_rate>50</update_rate>
        </sensor>
      </link>

      <!-- ----------------------------- -->
      <!-- RODAS (2 por lado)            -->
      <!-- Cada roda: cilindro rotacionado -90° em X para eixo ficar em Y    -->
      <!-- ----------------------------- -->
      <link name="left_wheel1">
        <pose>0.40  0.12 0.15 -1.57079632679 0 0</pose>
        <inertial><mass>1</mass></inertial>
        <collision name="collision">
          <geometry><cylinder><radius>0.07</radius><length>0.10</length></cylinder></geometry>
        </collision>
        <visual name="visual">
          <geometry><cylinder><radius>0.07</radius><length>0.10</length></cylinder></geometry>
          <material><diffuse>1 0 0 1</diffuse></material>
        </visual>
      </link>

      <link name="left_wheel2">
        <pose>0.70  0.12 0.15 -1.57079632679 0 0</pose>
        <inertial><mass>1</mass></inertial>
        <collision name="collision">
          <geometry><cylinder><radius>0.07</radius><length>0.10</length></cylinder></geometry>
        </collision>
        <visual name="visual">
          <geometry><cylinder><radius>0.07</radius><length>0.10</length></cylinder></geometry>
          <material><diffuse>1 0 0 1</diffuse></material>
        </visual>
      </link>

      <link name="right_wheel1">
        <pose>0.40 -0.12 0.15 -1.57079632679 0 0</pose>
        <inertial><mass>1</mass></inertial>
        <collision name="collision">
          <geometry><cylinder><radius>0.07</radius><length>0.10</length></cylinder></geometry>
        </collision>
        <visual name="visual">
          <geometry><cylinder><radius>0.07</radius><length>0.10</length></cylinder></geometry>
          <material><diffuse>1 0 0 1</diffuse></material>
        </visual>
      </link>

      <link name="right_wheel2">
        <pose>0.70 -0.12 0.15 -1.57079632679 0 0</pose>
        <inertial><mass>1</mass></inertial>
        <collision name="collision">
          <geometry><cylinder><radius>0.07</radius><length>0.10</length></cylinder></geometry>
        </collision>
        <visual name="visual">
          <geometry><cylinder><radius>0.07</radius><length>0.10</length></cylinder></geometry>
          <material><diffuse>1 0 0 1</diffuse></material>
        </visual>
      </link>

      <!-- Juntas: eixo Y no frame do MODELO (sem ficar dependente das rotações das rodas) -->
      <joint name="left_wheel1_joint" type="revolute">
        <parent>base_link</parent><child>left_wheel1</child>
        <axis>
          <xyz expressed_in="__model__">0 1 0</xyz>
          <limit><lower>-1e16</lower><upper>1e16</upper></limit>
        </axis>
      </joint>
      <joint name="left_wheel2_joint" type="revolute">
        <parent>base_link</parent><child>left_wheel2</child>
        <axis>
          <xyz expressed_in="__model__">0 1 0</xyz>
          <limit><lower>-1e16</lower><upper>1e16</upper></limit>
        </axis>
      </joint>
      <joint name="right_wheel1_joint" type="revolute">
        <parent>base_link</parent><child>right_wheel1</child>
        <axis>
          <xyz expressed_in="__model__">0 1 0</xyz>
          <limit><lower>-1e16</lower><upper>1e16</upper></limit>
        </axis>
      </joint>
      <joint name="right_wheel2_joint" type="revolute">
        <parent>base_link</parent><child>right_wheel2</child>
        <axis>
          <xyz expressed_in="__model__">0 1 0</xyz>
          <limit><lower>-1e16</lower><upper>1e16</upper></limit>
        </axis>
      </joint>

      <!-- ----------------------------- -->
      <!-- SENSORES                       -->
      <!-- ----------------------------- -->

      <!-- LiDAR em link próprio (CPU, funciona headless) -->
      <link name="lidar_link">
        <pose>0.5 0.0 0.5 0 0 0</pose>
        <inertial>
          <mass>0.1</mass>
          <inertia>
            <ixx>0.000166667</ixx>
            <iyy>0.000166667</iyy>
            <izz>0.000166667</izz>
          </inertia>
        </inertial>
        <collision name="collision">
    <geometry>
      <cylinder>
        <radius>0.06</radius>
        <length>0.07</length>
      </cylinder>
    </geometry>
  </collision>
  <visual name="visual">
    <geometry>
      <cylinder>
        <radius>0.06</radius>
        <length>0.07</length>
      </cylinder>
    </geometry>
    <material><diffuse>0.1 0.1 0.1 1</diffuse></material>
  </visual>
        <sensor name='gpu_lidar' type='gpu_lidar'>
          <topic>/lidar</topic>
          <update_rate>10</update_rate>
          <lidar>
            <scan>
              <horizontal>
                <samples>180</samples>
                <resolution>1</resolution>
                <min_angle>-1.396263</min_angle>
                <max_angle>1.396263</max_angle>
              </horizontal>
              <vertical>
                <samples>16</samples>
                <resolution>1</resolution>
                <min_angle>0.0</min_angle>
                <max_angle>0.0</max_angle>
              </vertical>
            </scan>
            <range>
              <min>0.08</min>
              <max>10.0</max>
              <resolution>0.01</resolution>
            </range>
          </lidar>
          <alwaysOn>1</alwaysOn>
          <visualize>true</visualize>
        </sensor>
      </link>
      
      <!-- prende o LiDAR no chassi -->
<joint name="lidar_fixed" type="fixed">
  <parent>base_link</parent>
  <child>lidar_link</child>
</joint>
      
      <!-- Câmera RGB em link próprio -->
      <link name="camera_link">
        <pose>0.50 0 0.40 0 0 0</pose>
        <sensor name="camera" type="camera">
          <pose>0 0 0 0 0 0</pose>
          <topic>/camera/image_raw</topic>
          <always_on>true</always_on>
          <update_rate>30</update_rate>
          <camera>
            <horizontal_fov>1.047</horizontal_fov>
            <image><width>640</width><height>480</height><format>R8G8B8</format></image>
            <clip><near>0.1</near><far>100</far></clip>
          </camera>
        </sensor>
      </link>
      <joint name="camera_fixed" type="fixed">
        <parent>base_link</parent><child>camera_link</child>
      </joint>

      <!-- ----------------------------- -->
      <!-- PLUGIN DE DIFERENCIAL          -->
      <!-- ----------------------------- -->
      <plugin name="ignition::gazebo::systems::DiffDrive"
              filename="libignition-gazebo-diff-drive-system.so">
        <!-- múltiplas rodas por lado (frente+trás) -->
        <left_joint>left_wheel1_joint</left_joint>
        <left_joint>left_wheel2_joint</left_joint>
        <right_joint>right_wheel1_joint</right_joint>
        <right_joint>right_wheel2_joint</right_joint>

        <!-- parâmetros coerentes com a geometria acima -->
        <wheel_radius>0.07</wheel_radius>
        <wheel_separation>0.24</wheel_separation> <!-- 0.12 - (-0.12) -->

        <odom_publish_frequency>30</odom_publish_frequency>
        <topic>/cmd_vel</topic>
        <odom_topic>/odom</odom_topic>
        <odom_frame>odom</odom_frame>
        <base_link>base_link</base_link>
        <publish_tf>true</publish_tf>
      </plugin>

      <!-- flags padrão -->
      <static>false</static>
      <self_collide>false</self_collide>
    </model>
    
    
  </world>
</sdf>

